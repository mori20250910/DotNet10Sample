DotNet10Sample プロジェクト
製造計画画面 詳細設計書

================================================================================
1. 画面概要
================================================================================

1.1 画面ID
P005

1.2 画面名
製造計画画面

1.3 ファイル名
	- ビュー: Manufacturing.cshtml
	- コードビハインド: Manufacturing.cshtml.cs
	- レイアウト: _Layout.cshtml

1.4 画面説明
月単位の製造計画を作成・編集するための画面。ユーザーは月を選択して、各品目の日別製造数
を入力・保存できる。祝日や休日は自動的に色分けされ、品目ごとの製造開始年月日より前の日
付には入力できないようになっている。データはCSV形式でも出力可能。

1.5 操作権限
	- 全ユーザー（認証済みユーザー）

1.6 初期表示権限チェック
	- Azure AD認証によるログイン状態確認
	- 未認証ユーザーはログインページへリダイレクト


================================================================================
2. 画面レイアウト
================================================================================

2.1 レイアウト構成
	┌─────────────────────────────────────────────────────────────┐
	│                    ナビゲーションバー                        │
	│  【ロゴ】 【メニュー】          【ユーザー情報】【ログアウト】│
	└─────────────────────────────────────────────────────────────┘
	┌─────────────────────────────────────────────────────────────┐
	│                                                             │
	│                    メインコンテンツエリア                    │
	│                                                             │
	│  製造計画                                                    │
	│                                                             │
	│  ┌─────────────────────────────────────────────────┐       │
	│  │ 月選択  【2026-01】  【◀ 前月】【次月 ▶】【表示】      │
	│  │                                                 │       │
	│  │ 表示期間：2026年1月1日 ～ 1月31日               │       │
	│  │                                                 │       │
	│  ├─────────────────────────────────────────────────┤       │
	│  │ （スクロール可能なテーブル）                      │       │
	│  │ ┌─────────────────────────────────────────────┐ │       │
	│  │ │品目│1/1  │1/2  │1/3  │... │              │ │       │
	│  │ │    │(金)│(土)│(日) │    │              │ │       │
	│  │ ├─────────────────────────────────────────────┤ │       │
	│  │ │品目A│ 10 │【】 │【】│...│              │ │       │
	│  │ │製造開始: 2026/1/1││     │    │    │              │ │       │
	│  │ ├─────────────────────────────────────────────┤ │       │
	│  │ │品目B│ 20 │ 10 │【】│...│              │ │       │
	│  │ │製造開始: 2026/1/15││  │    │    │              │ │       │
	│  │ └─────────────────────────────────────────────┘ │       │
	│  │                                                 │       │
	│  │ 【CSV出力】 【保存】 【メニューに戻る】        │       │
	│  │                                                 │       │
	│  └─────────────────────────────────────────────────┘       │
	│                                                             │
	└─────────────────────────────────────────────────────────────┘
	┌─────────────────────────────────────────────────────────────┐
	│  フッター | Copyright © 2026 DotNet10Sample. All rights... │
	└─────────────────────────────────────────────────────────────┘

2.2 画面サイズ
	- デバイス対応: レスポンシブデザイン
	- テーブル最大高さ: 600px（スクロール）
	- テーブル列幅: 固定レイアウト（品目列: 188px、日付列: 80px）
	- 品目列: 固定スティッキー（左スクロール時も常に表示）

2.3 背景・配色
	- 背景色: #F5F5F5（淡いグレー）
	- テキスト色: #333333（濃いグレー）
	- テーブル背景: #FFFFFF（白）
	- テーブル見出し背景: #F8F9FA（ライトグレー）
	- 休日セル背景: #FFCCCC（淡いピンク）
	- 入力フィールド背景: #FFFFFF（白）
	- 入力フィールド枠線: #CCCCCC（グレー）
	- disabled入力フィールド: #E9ECEF（グレー）
	- ボタン（primary）: #0066CC（青）
	- ボタン（secondary）: #6C757D（グレー）

2.4 フォント設定
	- 日本語フォント: "Segoe UI"、"Meiryo"、sans-serif
	- 見出し: 24px、太字
	- ラベル: 14px、太字
	- テーブル見出し: 13px、太字
	- テーブルデータ: 13px、通常
	- 数値入力: 13px、太字


================================================================================
3. 月選択・表示制御
================================================================================

3.1 月選択要素

要素ID | 要素名 | HTML要素 | データ型 | 説明
--------|--------|---------|---------|-------
C001 | 月選択 | <input type="month"> | String | yyyy-MM形式
C002 | 前月ボタン | <button> | - | 前月へ移動
C003 | 次月ボタン | <button> | - | 次月へ移動
C004 | 表示ボタン | <button type="submit"> | - | フォーム送信

3.2 月選択の詳細仕様

【月選択】
	- 要素ID: C001
	- フィールド名: YearMonth
	- 入力形式: <input type="month">
	- データ形式: "yyyy-MM"（例：2026-01）
	- デフォルト値: 現在月（DateTime.Now）
	- バリデーション: yyyy-MM形式で解析可能

【前月ボタン】
	- 要素ID: C002
	- HTML ID: prevMonthBtn
	- ボタン名: "◀ 前月"
	- スタイル: btn btn-outline-secondary
	- クリック時動作:
		1. 月選択フィールドの値を取得
		2. 月を1ヶ月前に変更（年をまたぐ場合は処理）
		3. フォーム送信（GET）

【次月ボタン】
	- 要素ID: C003
	- HTML ID: nextMonthBtn
	- ボタン名: "次月 ▶"
	- スタイル: btn btn-outline-secondary
	- クリック時動作:
		1. 月選択フィールドの値を取得
		2. 月を1ヶ月後に変更（年をまたぐ場合は処理）
		3. フォーム送信（GET）

【表示ボタン】
	- 要素ID: C004
	- HTML タイプ: submit
	- ボタン名: "表示"
	- スタイル: btn btn-primary
	- クリック時動作: フォーム送信（GET）


3.3 表示期間情報

【表示期間テキスト】
	- 表示位置: 月選択フォーム下
	- 表示内容: "表示期間：[StartDate] ～ [EndDate]"
	- 日付形式: "yyyy年M月d日" （例：2026年1月1日）


================================================================================
4. テーブル構造
================================================================================

4.1 テーブル構成

┌──────────┬──────┬──────┬──────┬──────┐
│ 品目     │ 1/1 │ 1/2 │ 1/3 │ ... │
│（固定）  │(金) │(土) │(日) │     │
├──────────┼──────┼──────┼──────┼──────┤
│ 品目A    │ 10  │ -   │ -   │ ... │
│ 製造開始: │ 【】│ 【】│ 【】│     │
│ 2026/1/1 │     │     │     │     │
├──────────┼──────┼──────┼──────┼──────┤
│ 品目B    │ 20  │ 10  │ -   │ ... │
│ 製造開始: │ 【】│ 【】│ 【】│     │
│ 2026/1/15│     │     │     │     │
└──────────┴──────┴──────┴──────┴──────┘

4.2 テーブル仕様

【全体】
	- 要素: <table class="table table-bordered table-sm">
	- レイアウト: table-layout: fixed（固定幅）
	- 最大高さ: 600px（overflow: auto でスクロール）
	- 枠線: 1px solid #dee2e6

【列の幅】
	- 品目列: 188px（固定、スティッキー）
	- 日付列: 80px（最小幅）
	- テーブル全体: 各列の合計

【品目列（1列目）】
	- 位置: position: sticky; left: 0; z-index により常に左側に表示
	- 背景色: #F8F9FA（見出しと同じ）
	- 内容:
		- 品目名（太字）
		- 製造開始年月日（小さいグレーテキスト）
	- パディング: 8px
	- 折り返し: overflow-wrap: break-word

【日付列（見出し）】
	- 背景色: #F8F9FA（通常） または #FFCCCC（祝日）
	- テキスト: "M/d" （例：1/1）
	- サブテキスト: "ddd" （例：金）を <small class="text-muted"> で表示
	- 祝日バッジ: <span class="badge bg-danger">祝</span>
	- タイトル属性: 祝日コメント（ホバー時に表示）
	- データ属性: data-holiday-note="祝日コメント"

【データセル】
	- 要素: <input type="text" class="qty-input">
	- テキスト配置: center
	- 幅: 100%（列の幅に自動調整）
	- パディング: 6px 4px
	- フォントウェイト: bold
	- プレースホルダ: "-"
	- 背景色: #FFFFFF（通常） または #FFCCCC（祝日）
	- 属性:
		- name="qty_{itemId}_{date}" （例：qty_1_2026-01-01）
		- data-item-id="{itemId}"
		- data-plan-date="{date}"
		- disabled（製造開始前または祝日の場合）

4.3 祝日表示

【祝日の定義】
	1. 日本の国家祝日（データベースから取得）
	2. カスタム祝日（データベースから取得）
	3. 土曜日・日曜日

【祝日の表示】
	- セル背景色: #FFCCCC（淡いピンク）
	- 祝日ラベル: data-holiday-note 属性に「祝日名」または「コメント」を設定
	- ホバー表示: title属性で祝日コメントを表示
	- 入力制御: 祝日セルの入力フィールドは disabled


================================================================================
5. 入力フィールド
================================================================================

5.1 数値入力仕様

【製造数入力フィールド】
	- HTML要素: <input type="text" class="qty-input">
	- データ型: 数値（1～99）
	- プレースホルダ: "-"
	- 入力可能な値: 1～99（整数のみ）
	- 空白入力: 許可（計画を削除）
	- 最大長: 2文字

5.2 入力制御

【disabled 状態】
	以下の場合、入力フィールドは disabled 状態に設定される:
	
	1. 製造開始年月日より前の日付
		- ItemManufactureStartDate が設定されている場合
		- 日付 < ItemManufactureStartDate ⇒ disabled
	
	2. 祝日
		- Holidays ハッシュセットに含まれる日付 ⇒ disabled

【クライアント側バリデーション】
	blur イベント時:
	1. 入力値を trim()
	2. 空白の場合は許可（処理終了）
	3. 数値に変換（parseInt）
	4. 1～99 の範囲外またはNaN ⇒ 値をクリア
	5. 有効な場合 ⇒ リーディングゼロを削除して表示

	keypress イベント時:
	- /[0-9]/ 以外のキーは preventDefault()

5.3 入力値の保存

【OnPostSaveAsync 処理】
	フォームデータから qty_itemId_date 形式のキーを抽出:
	
	1. キーをパース（qty_itemId_date）
	2. itemId、date を取得
	3. 入力値の検証:
		- 空白 ⇒ 既存レコードを削除
		- 数値1～99 ⇒ 保存
		- それ以外 ⇒ エラーメッセージを追加
	
	4. 製造開始年月日の確認:
		- date < item.ManufactureStartDate ⇒ エラー
	
	5. データベース保存:
		- 既存レコードあり ⇒ UpdateAsync
		- 既存レコードなし ⇒ InsertAsync


================================================================================
6. ボタン・操作
================================================================================

6.1 ボタン一覧

ボタンID | ボタン名 | 初期状態 | クリック時動作 | 説明
---------|---------|--------|----------------|-------
B001 | CSV出力 | 有効 | テーブル→CSV変換ダウンロード | テーブルデータをCSV形式で出力
B002 | 保存 | 有効 | フォーム送信（AJAX） | 製造計画をデータベースに保存
B003 | メニューに戻る | 有効 | ページ遷移 | メニュー画面へ遷移

6.2 各ボタンの詳細仕様

【CSV出力】
	- ボタンID: B001
	- HTML要素: <button type="button" id="exportCsvBtn">
	- ボタン名: "CSV出力"
	- スタイル: btn btn-outline-secondary
	- クリック時動作:
		1. テーブル要素を取得
		2. ヘッダ行を抽出（品目 + 日付）
		3. 祝日コメントをヘッダに追加（例：1/1 (祝日)）
		4. 各行データを抽出（品目名 + 製造数）
		5. CSV形式に変換（ダブルクォート、カンマエスケープ）
		6. BOM付きUTF-8で保存
		7. ファイル名: manufacturing_{YearMonth}.csv（例：manufacturing_2026-01.csv）
		8. ブラウザでダウンロード

【保存】
	- ボタンID: B002
	- HTML要素: <button type="button" id="saveBtn">
	- ボタン名: "保存"
	- スタイル: btn btn-primary
	- クリック時動作:
		1. バリデーションメッセージをクリア
		2. すべての qty-input をチェック
		3. 値が入力されている場合:
			- 数値に変換（parseInt）
			- 1～99 の範囲チェック
			- 範囲外またはNaN ⇒ エラーメッセージを追加
		4. エラーがある場合:
			- バリデーションメッセージを表示して終了
		5. エラーがない場合:
			- FormData を作成
			- YearMonth を hidden フィールドから設定
			- URLSearchParams に変換
			- fetch で POST リクエスト送信
				- ハンドラ: Save
				- ヘッダ: X-Requested-With: XMLHttpRequest
		6. レスポンス評価:
			成功時（200）:
			  - success === true ⇒ 成功メッセージ表示、1.2秒後にリロード
			  - success === false ⇒ エラーメッセージ表示（バリデーションエラー）
			
			エラー時（400）:
			  - エラーメッセージを表示
			
			エラー時（その他）:
			  - "通信エラーが発生しました。" を表示

【メニューに戻る】
	- ボタンID: B003
	- HTML要素: <a asp-page="/Index">
	- ボタン名: "メニューに戻る"
	- スタイル: btn btn-secondary
	- クリック時動作: Index.cshtml へナビゲート


================================================================================
7. メッセージ表示
================================================================================

7.1 メッセージ表示エリア

メッセージID | メッセージタイプ | 表示位置 | 表示条件 | スタイル
---|---|---|---|---
M001 | 成功メッセージ | ページ上部 | 保存成功時 | alert alert-success
M002 | バリデーションエラー | フォーム内 | 検証エラー時 | text-danger
M003 | サーバーエラー | フォーム内 | サーバー処理失敗時 | text-danger

7.2 各メッセージの詳細

【成功メッセージ】
	- メッセージID: M001
	- 表示位置: ページ上部（TempData）
	- 表示条件: 保存処理が成功した場合
	- メッセージテンプレート: "製造計画を保存しました。"
	- スタイル: alert alert-success
	- 表示方法: TempData["SuccessMessage"] を表示

【バリデーションエラー】
	- メッセージID: M002
	- 表示位置: #validationMessage エレメント
	- 表示条件: クライアント/サーバーサイドバリデーションエラー時
	- 典型的なエラーメッセージ:
		1. 数値入力エラー:
			"品目ID {itemId} の {MM/dd} の製造数は1～99の数字のみ入力可能です。"
		2. 製造開始年月日エラー:
			"品目「{品目名}」の製造開始年月日は {yyyy年M月d日} です。それより前の日付には入力できません。"
	- スタイル: text-danger
	- 複数エラー: <br /> で改行して表示

【サーバーエラー】
	- メッセージID: M003
	- 表示位置: #validationMessage エレメント
	- 表示条件: サーバー処理失敗時（月未指定など）
	- メッセージテンプレート: "月が指定されていません。"
	- スタイル: text-danger

【成功時の通知（タイトル）】
	- 保存成功時、ページタイトルを "製造計画を保存しました。" に変更
	- 1.2秒後に元のタイトルに戻してページをリロード
	- この方法でダイアログを使わずに保存完了を通知


================================================================================
8. 画面遷移
================================================================================

8.1 画面遷移図

	【メニュー画面】
	  ↓（「製造計画」をクリック）
	【製造計画画面】（このページ）
	  ↓（「メニューに戻る」をクリック）
	【メニュー画面】

8.2 画面遷移の詳細

遷移元 | 遷移先 | 遷移条件 | パラメータ
-----|-----|--------|-------
メニュー画面(Index) | 製造計画画面(Manufacturing) | メニューから「製造計画」を選択 | なし
製造計画画面(Manufacturing) | 製造計画画面(Manufacturing) | 月を変更して「表示」をクリック | YearMonth=yyyy-MM
製造計画画面(Manufacturing) | 製造計画画面(Manufacturing) | 「前月」「次月」をクリック | YearMonth=yyyy-MM（自動更新）
製造計画画面(Manufacturing) | メニュー画面(Index) | 「メニューに戻る」をクリック | なし
製造計画画面(Manufacturing) | ログインページ | 認証切れ/未認証 | （自動リダイレクト）

8.3 パラメータの詳細

【遷移時のクエリパラメータ】

製造計画画面への遷移:
	URL形式: /Manufacturing または /Manufacturing?YearMonth=yyyy-MM
	パラメータ:
	- YearMonth (省略可): 月の指定（形式：2026-01）
	  未指定の場合は現在月（DateTime.Now）をデフォルト


================================================================================
9. サーバーサイド処理
================================================================================

9.1 OnGetAsync() メソッド

【概要】
月の製造計画を取得し、画面にバインドする処理

【処理フロー】
1. YearMonth パラメータの取得（未指定時は現在月）
2. YearMonth をパース（yyyy-MM-01 から日付を抽出）
3. StartDate（月の1日）、EndDate（月の末日）を計算
4. 表示日付リスト（PlanDates）を生成
5. すべての品目を取得（SearchAsync）
6. 各品目の製造開始年月日をルックアップテーブルに設定
7. 祝日データを取得:
	- 日本の国家祝日（GetJapaneseHolidaysAsync）
	- カスタム祝日（GetCustomHolidaysAsync）
	- 土曜日・日曜日
8. 祝日ラベル（祝日名またはコメント）をマッピング
9. 製造計画データを取得（GetManufacturingPlansAsync）
10. ページを表示

【祝日処理の詳細】
	国家祝日:
	  - GetJapaneseHolidaysAsync(year) で年ごとに取得
	  - 複数年にまたがる場合は全て取得
	
	祝日ラベル:
	  - 国家祝日の名前を HolidayLabels に設定
	  - カスタム祝日のコメントがあれば上書き
	  - 国家祝日がない場合は "祝日" をデフォルト設定

【データ構造】
	Items: List<ItemRepository.Item>
	  全品目リスト
	
	PlanDates: List<DateTime>
	  表示対象の日付（StartDate ～ EndDate）
	
	PlanData: Dictionary<(int itemId, DateTime date), int>
	  (品目ID, 日付) → 製造数
	
	ItemManufactureStartDates: Dictionary<int, DateTime?>
	  品目ID → 製造開始年月日
	
	Holidays: HashSet<DateTime>
	  祝日の日付セット
	
	JapaneseHolidays: HashSet<DateTime>
	  国家祝日の日付セット（バッジ表示用）
	
	HolidayLabels: Dictionary<DateTime, string?>
	  日付 → 祝日名またはコメント


9.2 OnPostSaveAsync() メソッド

【概要】
フォームから送信された製造計画データを検証し、データベースに保存する処理

【処理フロー】
1. YearMonth パラメータの取得と検証
2. StartDate、EndDate を再計算
3. すべての品目を取得（SearchAsync）
4. エラーリストを初期化
5. フォームデータをループ処理:
	キーが "qty_" で始まる場合のみ処理
	
	a. キーをパース（qty_{itemId}_{date}）
	b. itemId、date を抽出
	c. 品目をIDで検索
	d. 入力値を取得して trim()
	
	e. 値の処理:
		空白 ⇒ 既存レコードを削除（DeleteManufacturingPlanAsync）
		数値1～99 ⇒ 保存処理へ（以下を続行）
		その他 ⇒ エラーを追加（continue）
	
	f. 製造開始年月日の確認:
		date < item.ManufactureStartDate ⇒ エラーを追加（continue）
	
	g. 保存処理:
		既存レコード確認（GetManufacturingPlanAsync）
		  - あり ⇒ UpdateAsync
		  - なし ⇒ InsertAsync

6. エラーがある場合:
	AJAX リクエスト:
	  HTTP 400 Bad Request で errors 配列を返す
	
	通常リクエスト:
	  ModelState にエラーを追加、ページを再表示

7. エラーがない場合:
	AJAX リクエスト:
	  JSON { success: true, message: "保存しました。" } を返す
	
	通常リクエスト:
	  TempData に成功メッセージ、当該ページにリダイレクト

【バリデーション詳細】
	YearMonth:
	  - 形式チェック: "yyyy-MM-01" で DateTime.TryParse
	  - 失敗時: BadRequest (400)
	
	品目ID・日付:
	  - int.TryParse、DateTime.TryParse で型チェック
	  - 失敗時: 行をスキップ
	
	製造数:
	  - int.TryParse で数値チェック
	  - 1 ～ 99 の範囲チェック
	  - 失敗時: エラーメッセージを追加
	
	製造開始年月日:
	  - date < item.ManufactureStartDate.Value ⇒ エラー


9.3 データベース操作

【SearchAsync】
	- 用途: キーワードで品目を検索（null の場合は全件取得）
	- パラメータ: keyword (nullable string)
	- 戻り値: List<ItemRepository.Item>

【GetJapaneseHolidaysAsync】
	- 用途: 指定年の国家祝日を取得
	- パラメータ: year (int)
	- 戻り値: List<ItemRepository.Holiday> （Date フィールド）

【GetJapaneseHolidaysWithNamesAsync】
	- 用途: 国家祝日を名前付きで取得
	- パラメータ: year (int)
	- 戻り値: List<{Date, Name}>

【GetCustomHolidaysAsync】
	- 用途: カスタム祝日を取得
	- パラメータ: なし
	- 戻り値: List<{HolidayDate, Comment}>

【GetManufacturingPlansAsync】
	- 用途: 指定期間の製造計画を取得
	- パラメータ: StartDate, EndDate (DateTime)
	- 戻り値: List<{ItemId, PlanDate, Quantity}>

【GetManufacturingPlanAsync】
	- 用途: 指定品目・日付の製造計画を取得
	- パラメータ: itemId (int), planDate (DateTime)
	- 戻り値: ManufacturingPlan? (null の可能性あり)

【InsertManufacturingPlanAsync】
	- 用途: 製造計画を新規作成
	- パラメータ: itemId (int), planDate (DateTime), quantity (int)
	- 戻り値: Task (非同期)

【UpdateManufacturingPlanAsync】
	- 用途: 製造計画を更新
	- パラメータ: itemId (int), planDate (DateTime), quantity (int)
	- 戻り値: Task (非同期)

【DeleteManufacturingPlanAsync】
	- 用途: 製造計画を削除
	- パラメータ: itemId (int), planDate (DateTime)
	- 戻り値: Task (非同期)


================================================================================
10. クライアントサイド処理
================================================================================

10.1 前月・次月ボタンのイベントハンドラー

【前月ボタン】
	要素ID: prevMonthBtn
	イベント: click
	
	処理:
	1. e.preventDefault()
	2. yearMonthInput.value をチェック（空の場合は終了）
	3. "yyyy-MM" をハイフンで分割、parseInt
	4. newMonth = month - 1
	5. newMonth < 1 の場合:
		newMonth = 12, newYear--
	6. yearMonthInput.value を更新（padStart で2桁にフォーマット）
	7. フォーム送信（yearMonthInput.form.submit()）

【次月ボタン】
	要素ID: nextMonthBtn
	イベント: click
	
	処理:
	1. e.preventDefault()
	2. yearMonthInput.value をチェック（空の場合は終了）
	3. "yyyy-MM" をハイフンで分割、parseInt
	4. newMonth = month + 1
	5. newMonth > 12 の場合:
		newMonth = 1, newYear++
	6. yearMonthInput.value を更新（padStart で2桁にフォーマット）
	7. フォーム送信（yearMonthInput.form.submit()）


10.2 保存ボタンのイベントハンドラー

【機能】
クライアント側でバリデーションを実施し、フォームをAJAX送信

【処理フロー】
1. e.preventDefault()
2. validationMessage をクリア
3. すべての qty-input をループ:
	値が空でない場合:
	  - parseInt で数値に変換
	  - isNaN || < 1 || > 99 ⇒ hasErrors = true、エラーメッセージを追加
4. hasErrors === true の場合:
	- validationMessage に表示して終了
5. FormData を作成
6. yearMonthHidden フィールドに yearMonthInput.value を設定
7. URLSearchParams に変換
8. fetch で POST リクエスト:
	- URL: window.location.pathname + '?handler=Save'
	- メソッド: POST
	- ヘッダ: X-Requested-With: XMLHttpRequest
	- ボディ: URLSearchParams
9. レスポンス処理:
	成功（200-299）:
	  - JSON をパース
	  - success === true:
	    - ページタイトルを "製造計画を保存しました。" に変更
	    - 1200ms 後にタイトルを復元してページをリロード
	  - success === false:
	    - validationMessage にエラーを表示（HTMLで改行）
	
	エラー（400）:
	  - JSON をパース
	  - errors 配列をvalidationMessage に表示
	
	エラー（その他）:
	  - エラーメッセージを表示
	
	通信エラー:
	  - catch ブロックで "通信エラーが発生しました。" を表示


10.3 数値入力フィールドの入力制御

【blur イベント】
	入力フィールドからフォーカスが外れた時:
	1. value を trim()
	2. 空の場合は終了（許可）
	3. parseInt で数値に変換
	4. isNaN || < 1 || > 99 ⇒ value をクリア
	5. 有効な場合 ⇒ value = quantity.toString()（リーディングゼロ削除）

【keypress イベント】
	入力時:
	1. /[0-9]/ 以外のキー ⇒ e.preventDefault()
	- 数字以外の入力は受け付けない


10.4 CSV出力機能

【概要】
テーブルのデータをCSV形式に変換してダウンロード

【処理フロー】
1. e.preventDefault()
2. テーブル要素を取得（.table）
3. ヘッダ行を抽出:
	- "品目" を最初の列に追加
	- 各日付セル（data-holiday-note 属性を確認）から：
	  - 日付テキストを抽出
	  - note がある場合は "{date} ({note})" に追加
4. 各行を処理:
	- 品目列: テキストを抽出（空白正規化）
	- 日付列: input の value を抽出
5. CSV形式に変換:
	- ダブルクォートでエスケープ（"text" ⇒ """text""" に）
	- カンマで列を区切り
	- 改行で行を区切り
6. BOM（\uFEFF）を先頭に付加（UTF-8）
7. Blob を作成（text/csv;charset=utf-8）
8. ダウンロードリンクを作成:
	- ファイル名: manufacturing_{YearMonth}.csv
	- 例: manufacturing_2026-01.csv
9. 動的にリンクをクリック（自動ダウンロード）
10. リンク削除、ObjectURL を解放


10.5 スタイル設定

【テーブル】
	- table: margin-bottom: 0
	- table-responsive:
		- max-height: 600px
		- overflow: auto
		- border: 1px solid #dee2e6

【入力フィールド】
	- qty-input: font-weight: bold
	- qty-input:disabled:
		- background-color: #e9ecef
		- cursor: default

【見出し】
	- thead th: vertical-align: middle

【祝日コメント】
	- .has-note: cursor: default（ホバー時にも表示）


================================================================================
11. データバインディング
================================================================================

11.1 プロパティバインディング一覧

プロパティ名 | BindProperty | SupportsGet | 説明 | バインド方向
---|---|---|---|---
YearMonth | ○ | ○ | 月（yyyy-MM形式） | Get/Post
StartDate | ✕ | ✕ | 月の開始日 | 計算値
EndDate | ✕ | ✕ | 月の終了日 | 計算値
Items | ✕ | ✕ | すべての品目リスト | サーバー側のみ
PlanDates | ✕ | ✕ | 表示対象の日付リスト | サーバー側のみ
PlanData | ✕ | ✕ | 製造計画データ | サーバー側のみ
ItemManufactureStartDates | ✕ | ✕ | 品目の製造開始年月日 | サーバー側のみ
Holidays | ✕ | ✕ | 祝日セット | サーバー側のみ
JapaneseHolidays | ✕ | ✕ | 国家祝日セット | サーバー側のみ
HolidayLabels | ✕ | ✕ | 祝日ラベルマップ | サーバー側のみ

11.2 バインディング詳細

【クエリパラメータ（GET）】
	?YearMonth=2026-01

【フォーム送信（POST）】
	form data:
	- YearMonth
	- qty_1_2026-01-01
	- qty_1_2026-01-02
	- qty_2_2026-01-01
	- ... （品目数 × 日数分）


================================================================================
